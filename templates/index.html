<!DOCTYPE html>
<html lang="{{ current_language }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ translations.title }}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä {{ translations.title }}</h1>
            <div class="language-switcher">
                <button class="language-btn{% if current_language == 'ru' %} active{% endif %}" onclick="switchLanguage('ru')">üá∑üá∫ RU</button>
                <button class="language-btn{% if current_language == 'en' %} active{% endif %}" onclick="switchLanguage('en')">üá∫üá∏ EN</button>
            </div>
        </div>
        
        <div class="stats">
            {% for stat in stats %}
            <div class="user-stat"{% if has_difficulty_data and stat.get('easy_progress') is not none %} data-tooltip="true"{% endif %}>
                <h3>{{ stat.username }}</h3>
                <p><span data-translate="stats.total_solved">{{ translations.stats.total_solved }}</span> <strong>{{ stat.total }}</strong></p>
                <p><span data-translate="stats.progress">{{ translations.stats.progress }}</span> <strong>+{{ stat.progress }}</strong></p>
                {% if has_difficulty_data %}
                <div class="difficulty-stats">
                    <span class="easy"><span data-translate="stats.easy">{{ translations.stats.easy }}</span> {{ stat.easy }}</span>
                    <span class="medium"><span data-translate="stats.medium">{{ translations.stats.medium }}</span> {{ stat.medium }}</span>
                    <span class="hard"><span data-translate="stats.hard">{{ translations.stats.hard }}</span> {{ stat.hard }}</span>
                </div>
                <div class="tooltip-content">
                    <div class="tooltip-header" data-translate="stats.difficulty_progress">{{ translations.stats.difficulty_progress }}</div>
                    <div class="tooltip-item easy"><span data-translate="stats.easy">{{ translations.stats.easy }}</span> +{{ stat.easy_progress }}</div>
                    <div class="tooltip-item medium"><span data-translate="stats.medium">{{ translations.stats.medium }}</span> +{{ stat.medium_progress }}</div>
                    <div class="tooltip-item hard"><span data-translate="stats.hard">{{ translations.stats.hard }}</span> +{{ stat.hard_progress }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <button class="refresh-btn" onclick="updateData()" id="updateBtn" data-translate="buttons.refresh">{{ translations.buttons.refresh }}</button>
        
        <div class="loading" id="loading">
            <p data-translate="loading.updating">{{ translations.loading.updating }}</p>
        </div>
        
        <div id="message"></div>
        
        <div class="chart-tabs">
            <button class="tab-btn active" data-chart="progress" data-translate="charts.progress_tab">{{ translations.charts.progress_tab }}</button>
            <button class="tab-btn" data-chart="total" data-translate="charts.total_tab">{{ translations.charts.total_tab }}</button>
            <button class="tab-btn" data-chart="daily" data-translate="charts.daily_tab">{{ translations.charts.daily_tab }}</button>
            {% if has_difficulty_data %}
            <button class="tab-btn" data-chart="difficulty-breakdown" data-translate="charts.difficulty_breakdown_tab">{{ translations.charts.difficulty_breakdown_tab }}</button>
            <button class="tab-btn" data-chart="difficulty-total" data-translate="charts.difficulty_total_tab">{{ translations.charts.difficulty_total_tab }}</button>
            <button class="tab-btn" data-chart="difficulty-progress" data-translate="charts.difficulty_progress_tab">{{ translations.charts.difficulty_progress_tab }}</button>
            <button class="tab-btn" data-chart="heatmap" data-translate="charts.heatmap_tab">{{ translations.charts.heatmap_tab }}</button>
            {% endif %}
        </div>
        
        <div class="charts">
            <div class="chart active" id="progress-chart">
                <h2 data-translate="charts.progress_title">{{ translations.charts.progress_title }}</h2>
                <div id="progressChart" class="plot-container"></div>
            </div>
            
            <div class="chart" id="total-chart">
                <h2 data-translate="charts.total_title">{{ translations.charts.total_title }}</h2>
                <div id="totalChart" class="plot-container"></div>
            </div>
            
            <div class="chart" id="daily-chart">
                <h2 data-translate="charts.daily_title">{{ translations.charts.daily_title }}</h2>
                <div id="dailyChart" class="plot-container"></div>
            </div>
            
            {% if has_difficulty_data %}
            <div class="chart" id="difficulty-breakdown-chart">
                <h2 data-translate="charts.difficulty_breakdown_title">{{ translations.charts.difficulty_breakdown_title }}</h2>
                <div id="difficultyBreakdownChart" class="plot-container"></div>
            </div>
            
            <div class="chart" id="difficulty-total-chart">
                <h2 data-translate="charts.difficulty_total_title">{{ translations.charts.difficulty_total_title }}</h2>
                <div class="difficulty-controls">
                    <button class="difficulty-btn active" data-difficulty="easy" onclick="toggleDifficultyLevel('difficulty-total', 'easy')">
                        <span class="difficulty-marker easy"></span><span data-translate="stats.easy">{{ translations.stats.easy }}</span>
                    </button>
                    <button class="difficulty-btn active" data-difficulty="medium" onclick="toggleDifficultyLevel('difficulty-total', 'medium')">
                        <span class="difficulty-marker medium"></span><span data-translate="stats.medium">{{ translations.stats.medium }}</span>
                    </button>
                    <button class="difficulty-btn active" data-difficulty="hard" onclick="toggleDifficultyLevel('difficulty-total', 'hard')">
                        <span class="difficulty-marker hard"></span><span data-translate="stats.hard">{{ translations.stats.hard }}</span>
                    </button>
                </div>
                <div id="difficultyTotalChart" class="plot-container"></div>
            </div>
            
            <div class="chart" id="difficulty-progress-chart">
                <h2 data-translate="charts.difficulty_progress_title">{{ translations.charts.difficulty_progress_title }}</h2>
                <div class="difficulty-controls">
                    <button class="difficulty-btn active" data-difficulty="easy" onclick="toggleDifficultyLevel('difficulty-progress', 'easy')">
                        <span class="difficulty-marker easy"></span><span data-translate="stats.easy">{{ translations.stats.easy }}</span>
                    </button>
                    <button class="difficulty-btn active" data-difficulty="medium" onclick="toggleDifficultyLevel('difficulty-progress', 'medium')">
                        <span class="difficulty-marker medium"></span><span data-translate="stats.medium">{{ translations.stats.medium }}</span>
                    </button>
                    <button class="difficulty-btn active" data-difficulty="hard" onclick="toggleDifficultyLevel('difficulty-progress', 'hard')">
                        <span class="difficulty-marker hard"></span><span data-translate="stats.hard">{{ translations.stats.hard }}</span>
                    </button>
                </div>
                <div id="difficultyProgressChart" class="plot-container"></div>
            </div>
            
            <div class="chart" id="heatmap-chart">
                <h2 data-translate="charts.heatmap_title">{{ translations.charts.heatmap_title }}</h2>
                <div id="heatmapChart" class="plot-container"></div>
            </div>
            {% endif %}
        </div>
        
        <div class="last-update">
            <span data-translate="stats.last_update">{{ translations.stats.last_update }}</span> {{ last_update }}
        </div>
    </div>
    
    <script src="/static/js/app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–∞–ª–∏—á–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        window.hasDifficultyData = {{ 'true' if has_difficulty_data else 'false' }};
        
        // –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è JavaScript
        window.translations = {{ translations | tojson }};
        window.currentLanguage = '{{ current_language }}';
        window.supportedLanguages = {{ supported_languages | tojson }};
    </script>
</body>
</html>
